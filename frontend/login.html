<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Coded | Login</title>
  <link rel="manifest" href="manifest.json">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: #000000;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }

    .container {
      width: 100%;
      max-width: 420px;
      padding: 40px 24px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .logo {
      width: 150px;
      height: 100px;
      margin-bottom: 80px;
    }

    .logo img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .form-wrapper {
      width: 100%;
      margin-bottom: 24px;
    }

    .input-wrapper {
      position: relative;
      margin-bottom: 20px;
    }

    .email-input,
    .password-input {
      width: 100%;
      height: 52px;
      background: transparent;
      border: none;
      border-bottom: 2px solid #2A2A2A;
      color: #FFFFFF;
      font-size: 18px;
      padding: 0 4px;
      outline: none;
    }

    .email-input::placeholder,
    .password-input::placeholder {
      color: #8E8E8E;
    }

    .error-text {
      color: #FF453A;
      font-size: 14px;
      margin-top: 8px;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .error-text.visible {
      opacity: 1;
    }

    .continue-btn {
      width: 100%;
      height: 52px;
      background: #FFFFFF;
      color: #000000;
      font-size: 17px;
      font-weight: 600;
      border: none;
      border-radius: 26px;
      cursor: pointer;
      opacity: 0.5;
      transition: opacity 0.3s ease;
      margin-bottom: 16px;
    }

    .continue-btn.enabled {
      opacity: 1;
    }

    .divider {
      width: 100%;
      text-align: center;
      margin: 24px 0;
      position: relative;
      color: #6E6E6E;
      font-size: 14px;
    }

    .divider::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 1px;
      background: #2A2A2A;
    }

    .divider span {
      background: #000000;
      padding: 0 16px;
    }

    .google-btn {
      width: 100%;
      height: 52px;
      background: #1F1F1F;
      color: #FFFFFF;
      font-size: 17px;
      font-weight: 600;
      border: 1px solid #2A2A2A;
      border-radius: 26px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      transition: background 0.3s ease;
    }

    .google-btn:hover {
      background: #2A2A2A;
    }

    .google-btn img {
      width: 20px;
      height: 20px;
    }

    .signup-link {
      margin-top: 24px;
      font-size: 15px;
      color: #FFFFFF;
      text-align: center;
    }

    .signup-link a {
      color: #FFFFFF;
      font-weight: 600;
      text-decoration: underline;
    }

    .terms {
      margin-top: auto;
      padding-top: 60px;
      font-size: 12px;
      color: #6E6E6E;
      text-align: center;
      line-height: 1.4;
    }

    /* Very small toast notification */
    #toast {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(31, 31, 31, 0.95);
      color: #FFFFFF;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, transform 0.3s ease;
      z-index: 200;
      max-width: 90%;
      text-align: center;
      backdrop-filter: blur(8px);
    }

    #toast.show {
      opacity: 1;
      visibility: visible;
      transform: translateX(-50%) translateY(-8px);
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo">
      <img src="asset/logo.png" alt="Coded Logo">
    </div>

    <div class="form-wrapper">
      <div class="input-wrapper">
        <input
          type="email"
          class="email-input"
          placeholder="Email address"
          id="email"
          autocomplete="email"
          autofocus
        />
      </div>

      <div class="input-wrapper">
        <input
          type="password"
          class="password-input"
          placeholder="Password"
          id="password"
          autocomplete="current-password"
        />
        <div class="error-text" id="error">Invalid email or password</div>
      </div>
    </div>

    <button class="continue-btn" id="continue" disabled>Continue</button>

    <div class="divider"><span>or</span></div>

    <button class="google-btn" id="google">
      <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google G Logo">
      Continue with Google
    </button>

    <div class="signup-link">
      Don't have an account? <a href="signup.html">Sign up</a>
    </div>

    <div class="terms">
      By continuing, you agree to our Terms & Privacy Policy
    </div>
  </div>

  <!-- Very small toast element -->
  <div id="toast"></div>

  <script>
    // Toast function - very small and subtle
    function showToast(message, duration = 2000) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');

      clearTimeout(toast.hideTimeout);
      toast.hideTimeout = setTimeout(() => {
        toast.classList.remove('show');
      }, duration);
    }

    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const continueBtn = document.getElementById('continue');
    const errorText = document.getElementById('error');

    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    function validateForm() {
      const email = emailInput.value.trim();
      const password = passwordInput.value;

      if (email === '' || password === '') {
        continueBtn.disabled = true;
        continueBtn.classList.remove('enabled');
        errorText.classList.remove('visible');
        return false;
      }

      if (!emailRegex.test(email)) {
        errorText.textContent = 'Please enter a valid email address';
        errorText.classList.add('visible');
        continueBtn.disabled = true;
        continueBtn.classList.remove('enabled');
        return false;
      }

      errorText.classList.remove('visible');
      continueBtn.disabled = false;
      continueBtn.classList.add('enabled');
      return true;
    }

    emailInput.addEventListener('input', validateForm);
    passwordInput.addEventListener('input', validateForm);

    continueBtn.addEventListener('click', async () => {
      if (!validateForm()) return;

      const email = emailInput.value.trim();
      const password = passwordInput.value;

      errorText.classList.remove('visible');
      continueBtn.disabled = true;
      continueBtn.textContent = 'Logging in...';

      try {
        const response = await fetch('https://coded-wt2w.onrender.com/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ email, password }),
        });

        const data = await response.json();

        if (!response.ok) {
          errorText.textContent = data.error || 'Login failed';
          errorText.classList.add('visible');
          throw new Error(data.error || 'Login failed');
        }

        // Success: store token and redirect
        localStorage.setItem('token', data.token);
        localStorage.setItem('userId', data.userId);
        showToast('Login successful!');
        setTimeout(() => {
          window.location.href = 'live-requests.html';
        }, 800);

      } catch (err) {
        console.error('Login error:', err);
        showToast('An error occurred');
      } finally {
        continueBtn.disabled = false;
        continueBtn.textContent = 'Continue';
      }
    });

    document.getElementById('google').addEventListener('click', () => {
      window.location.href = 'https://coded-wt2w.onrender.com/auth/google';
    });

    validateForm();

    // Register service worker for PWA
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js')
        .then(reg => console.log('Service Worker registered', reg))
        .catch(err => console.error('Service Worker registration failed', err));
    }
  </script>
</body>
</html>